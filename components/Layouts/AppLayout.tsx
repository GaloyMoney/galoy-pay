import copy from "copy-to-clipboard"
import Link from "next/link"
import { useRouter } from "next/router"
import React from "react"
import { Image, OverlayTrigger, Tooltip } from "react-bootstrap"

import { URL_HOST_DOMAIN } from "../../config/config"
import styles from "./app-layout.module.css"

type Props = {
  children: React.ReactPortal | React.ReactNode
  username: string | string[] | undefined
}

const AppLayout = ({ children, username }: Props) => {
  const { memo } = useRouter().query
  const [openSideBar, setOpenSideBar] = React.useState<boolean>(false)
  const [copied, setCopied] = React.useState<boolean>(false)
  const lightningAddr = `${username?.toString().toLowerCase()}@${URL_HOST_DOMAIN}`

  const cashRegisterLink = memo
    ? `/${username}?amount=0&sats=0&currency=BTC&unit=CENT&memo=${memo.toString()}`
    : `/${username}`

  const copyToClipboard = () => {
    copy(lightningAddr)
    setCopied(true)
    setTimeout(() => {
      setCopied(false)
    }, 2000)
  }

  const closeSideBar = () => {
    setOpenSideBar(false)
  }

  return (
    <div className={`${openSideBar && styles.container_bg} ${styles.container}`}>
      <nav className={styles.nav_bar}>
        <a href={`/${username}`} style={{ cursor: "pointer" }}>
          <svg
            width="14"
            height="28"
            viewBox="0 0 14 28"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M0 2.7168V27.9499H6.66049C6.66049 27.9499 13.6185 27.9499 13.6185 21.0529C13.6185 11.6254 1.23342 11.1931 0.854496 5.52188C0.71208 3.39836 0 2.7168 0 2.7168Z"
              fill="url(#paint0_linear_1247_17156)"
            />
            <path
              d="M0 2.71713C0 2.71713 0 -0.0498047 4.83706 -0.0498047C8.95949 -0.0498047 10.4142 3.48771 10.4142 5.28317C10.4142 8.869 6.43161 11.9742 4.08937 15.3337C1.10118 19.6189 0 25.5317 0 27.9502V2.71713Z"
              fill="url(#paint1_linear_1247_17156)"
            />
            <defs>
              <linearGradient
                id="paint0_linear_1247_17156"
                x1="11.0449"
                y1="34.5213"
                x2="-3.0416"
                y2="-1.73879"
                gradientUnits="userSpaceOnUse"
              >
                <stop offset="0.12" stopColor="#3DE8F4" />
                <stop offset="0.16" stopColor="#38CFF1" />
                <stop offset="0.24" stopColor="#2C8FEB" />
                <stop offset="0.36" stopColor="#1A2DE2" />
                <stop offset="0.39" stopColor="#3331C9" />
                <stop offset="0.47" stopColor="#673B96" />
                <stop offset="0.55" stopColor="#94436A" />
                <stop offset="0.62" stopColor="#B94A46" />
                <stop offset="0.7" stopColor="#D64F2A" />
                <stop offset="0.77" stopColor="#EA5316" />
                <stop offset="0.85" stopColor="#F6550A" />
                <stop offset="0.92" stopColor="#FB5607" />
              </linearGradient>
              <linearGradient
                id="paint1_linear_1247_17156"
                x1="-1.43942"
                y1="25.697"
                x2="5.28465"
                y2="4.03957"
                gradientUnits="userSpaceOnUse"
              >
                <stop stopColor="#FFBE0B" />
                <stop offset="1" stopColor="#FB5607" />
              </linearGradient>
            </defs>
          </svg>
        </a>
        <div onClick={() => setOpenSideBar(!openSideBar)} className={styles.hamburger}>
          <span className={`${openSideBar && styles.toggle}`}></span>
          <span className={`${openSideBar && styles.toggle}`}></span>
          <span className={`${openSideBar && styles.toggle}`}></span>
        </div>
        <ul className={`${openSideBar && styles.nav_menu_bg} ${styles.nav_menu}`}>
          <li>{`Ways to pay ${username ?? "user"} `}</li>
          <li onClick={closeSideBar}>
            <Link href={cashRegisterLink}>
              <a>
                <Image src="/register-black&white.svg" width={"15"} height={"15"} />
                Cash Register App
              </a>
            </Link>
          </li>
          <li onClick={closeSideBar}>
            <Link href={memo ? `/${username}/print?memo=${memo}` : `/${username}/print`}>
              <a>
                <Image src="/paycode-black&white.svg" width={"15"} height={"15"} />
                Printable Paycode
              </a>
            </Link>
          </li>
          <div className={styles.lightning_addr}>
            <div>
              <Image src="/at-black&white.svg" width={"15"} height={"15"} />
              <div>
                <p>Lightning address:</p>
                <p>{lightningAddr}</p>
              </div>
            </div>
            <div>
              <OverlayTrigger
                show={copied}
                placement="bottom"
                overlay={<Tooltip id="copy">Copied!</Tooltip>}
              >
                <button onClick={copyToClipboard}>
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 34 34"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M19.2779 26.6961H8.0999C6.06243 26.6939 4.10905 25.8836 2.66833 24.4429C1.22762 23.0021 0.417258 21.0488 0.415039 19.0113L0.415039 7.8333C0.417258 5.79583 1.22762 3.84244 2.66833 2.40173C4.10905 0.961022 6.06243 0.150657 8.0999 0.148438L19.2779 0.148438C21.3154 0.150657 23.2687 0.961022 24.7095 2.40173C26.1502 3.84244 26.9605 5.79583 26.9627 7.8333V19.0113C26.9605 21.0488 26.1502 23.0021 24.7095 24.4429C23.2687 25.8836 21.3154 26.6939 19.2779 26.6961ZM8.0999 4.34018C7.17347 4.34018 6.28498 4.70821 5.62989 5.36329C4.97481 6.01838 4.60678 6.90687 4.60678 7.8333V19.0113C4.60678 19.9377 4.97481 20.8262 5.62989 21.4813C6.28498 22.1364 7.17347 22.5044 8.0999 22.5044H19.2779C20.2043 22.5044 21.0928 22.1364 21.7479 21.4813C22.403 20.8262 22.771 19.9377 22.771 19.0113V7.8333C22.771 6.90687 22.403 6.01838 21.7479 5.36329C21.0928 4.70821 20.2043 4.34018 19.2779 4.34018H8.0999ZM33.949 25.9975V9.92917C33.949 9.37331 33.7282 8.84022 33.3351 8.44717C32.9421 8.05412 32.409 7.8333 31.8531 7.8333C31.2973 7.8333 30.7642 8.05412 30.3711 8.44717C29.9781 8.84022 29.7572 9.37331 29.7572 9.92917V25.9975C29.7572 26.924 29.3892 27.8124 28.7341 28.4675C28.079 29.1226 27.1906 29.4906 26.2641 29.4906H10.1958C9.63991 29.4906 9.10682 29.7115 8.71377 30.1045C8.32072 30.4976 8.0999 31.0307 8.0999 31.5865C8.0999 32.1424 8.32072 32.6755 8.71377 33.0685C9.10682 33.4616 9.63991 33.6824 10.1958 33.6824H26.2641C28.3016 33.6802 30.255 32.8698 31.6957 31.4291C33.1364 29.9884 33.9468 28.035 33.949 25.9975Z"
                      fill="#536FF2"
                    />
                  </svg>
                  Copy
                </button>
              </OverlayTrigger>
              <button>
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 35 34"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clipPath="url(#clip0_1229_33614)">
                    <path
                      d="M11.7861 9.44018L15.6717 5.55322L15.7011 24.5997C15.7011 25.7571 16.6394 26.6955 17.7968 26.6955C18.9543 26.6955 19.8926 25.7571 19.8926 24.5997L19.8633 5.577L23.7265 9.44024C24.5306 10.2728 25.8574 10.2958 26.69 9.49172C27.5225 8.68759 27.5456 7.36083 26.7414 6.52828C26.7245 6.5108 26.7074 6.49364 26.69 6.47681L22.2022 1.98902C19.7468 -0.466382 15.7659 -0.466382 13.3105 1.98896L13.3104 1.98902L8.82271 6.47674C8.01858 7.30929 8.04164 8.63605 8.87418 9.44018C9.68637 10.2246 10.974 10.2246 11.7861 9.44018Z"
                      fill="#536FF2"
                    />
                    <path
                      d="M32.384 20.4053C31.2265 20.4053 30.2882 21.3436 30.2882 22.5011V28.9155C30.2874 29.2308 30.0321 29.4862 29.7168 29.487H5.71026C5.39497 29.4862 5.13955 29.2308 5.13883 28.9155V22.5011C5.13883 21.3436 4.20051 20.4053 3.04305 20.4053C1.88559 20.4053 0.947266 21.3436 0.947266 22.5011V28.9155C0.950344 31.5448 3.08103 33.6755 5.71026 33.6785H29.7167C32.346 33.6755 34.4766 31.5448 34.4797 28.9155V22.5011C34.4798 21.3436 33.5414 20.4053 32.384 20.4053Z"
                      fill="#536FF2"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_1229_33614">
                      <rect
                        width="33.534"
                        height="33.534"
                        fill="white"
                        transform="translate(0.949219 0.148438)"
                      />
                    </clipPath>
                  </defs>
                </svg>
                Share
              </button>
            </div>
          </div>
        </ul>
      </nav>
      <div className={styles.divider}></div>
      <main className={`${openSideBar && styles.main_bg} ${styles.main}`}>
        {children}
      </main>
      <footer className={styles.footer}>
        <a href="https://galoy.io" target="_blank" rel="noreferrer">
          <span>Powered by</span>
          <svg
            width="41"
            height="18"
            viewBox="0 0 41 18"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M16.9712 10.4692C16.8579 10.4918 16.7445 10.5113 16.628 10.5275C16.5146 10.5437 16.411 10.5566 16.3171 10.5728C16.1196 10.6019 15.9447 10.6473 15.7957 10.712C15.6468 10.7768 15.5334 10.861 15.4492 10.9711C15.3683 11.078 15.3262 11.2107 15.3262 11.3694C15.3262 11.5993 15.4104 11.7774 15.5755 11.8973C15.7439 12.0171 15.9609 12.0754 16.2199 12.0754C16.479 12.0754 16.6895 12.0268 16.8806 11.9296C17.0716 11.8293 17.2206 11.6932 17.3307 11.5249C17.4408 11.3565 17.4926 11.1622 17.4926 10.9484V10.3008C17.4408 10.3364 17.3663 10.3655 17.2724 10.3947C17.1817 10.4206 17.0813 10.4465 16.9647 10.4692H16.9712Z"
              fill="#536FF2"
            />
            <path
              d="M38.5994 0.200195H2.3986C1.07414 0.200195 -0.000976562 1.27531 -0.000976562 2.59977V15.4007C-0.000976562 16.7252 1.07414 17.8003 2.3986 17.8003H38.5994C39.9239 17.8003 40.999 16.7252 40.999 15.4007V2.59977C40.999 1.27531 39.9239 0.200195 38.5994 0.200195ZM12.7352 9.79525C12.7352 10.5109 12.583 11.1262 12.2819 11.6411C11.9807 12.1527 11.563 12.5478 11.0319 12.8263C10.5008 13.1015 9.89524 13.2408 9.20872 13.2408C8.44449 13.2408 7.77416 13.0724 7.19774 12.7356C6.62133 12.3956 6.16797 11.9163 5.84414 11.2913C5.52355 10.6664 5.36163 9.92154 5.36163 9.0634C5.36163 8.40279 5.45554 7.81342 5.6466 7.29853C5.8409 6.7804 6.10968 6.33999 6.45941 5.97731C6.80591 5.61786 7.2107 5.3426 7.67377 5.15478C8.13361 4.96696 8.63554 4.87305 9.1731 4.87305C9.63294 4.87305 10.0636 4.94105 10.4619 5.07706C10.8603 5.20983 11.2132 5.39765 11.5209 5.64052C11.8317 5.8834 12.0843 6.17484 12.2819 6.51162C12.4794 6.84517 12.6025 7.21433 12.6607 7.61588H10.9121C10.857 7.42158 10.7793 7.24995 10.6789 7.10423C10.5785 6.95203 10.4555 6.82574 10.3097 6.72211C10.1673 6.61525 10.0021 6.53429 9.81752 6.47924C9.63294 6.42419 9.43217 6.39504 9.20872 6.39504C8.79098 6.39504 8.42506 6.49867 8.11094 6.70592C7.79683 6.91317 7.55396 7.21433 7.37909 7.6094C7.20422 8.00124 7.11679 8.4805 7.11679 9.05044C7.11679 9.62038 7.20422 10.0996 7.37585 10.498C7.54748 10.8963 7.79359 11.2007 8.1077 11.4079C8.42182 11.6152 8.79422 11.7188 9.22491 11.7188C9.61351 11.7188 9.94705 11.6508 10.2223 11.5115C10.5008 11.3723 10.7113 11.1748 10.8603 10.9189C11.0027 10.6761 11.074 10.3943 11.0805 10.0673H9.33178V8.77195H12.7417V9.79849H12.7352V9.79525ZM19.1794 13.1242H17.5732V12.2758H17.5247C17.4275 12.4668 17.2947 12.6352 17.1296 12.781C16.9644 12.9234 16.7669 13.0368 16.537 13.1177C16.3071 13.1987 16.0383 13.2376 15.7371 13.2376C15.3485 13.2376 14.9988 13.1695 14.6944 13.0335C14.39 12.8943 14.1471 12.6935 13.969 12.4247C13.7941 12.1527 13.7067 11.8159 13.7067 11.4144C13.7067 11.0744 13.7682 10.7894 13.8945 10.5595C14.0208 10.3296 14.1892 10.1417 14.4029 10.0025C14.6167 9.86325 14.8628 9.75639 15.1348 9.68515C15.4101 9.61391 15.6983 9.56209 16.0027 9.53295C16.3589 9.49733 16.6438 9.46171 16.8608 9.42932C17.0778 9.3937 17.2364 9.34513 17.3336 9.27712C17.4307 9.21236 17.4793 9.11197 17.4793 8.98244V8.95977C17.4793 8.70718 17.3984 8.51289 17.2397 8.37364C17.0842 8.23439 16.8608 8.16639 16.5726 8.16639C16.2682 8.16639 16.0253 8.23439 15.844 8.3704C15.6626 8.50317 15.5428 8.67156 15.4845 8.87234L13.9172 8.74604C13.9982 8.37364 14.1536 8.05305 14.3868 7.78427C14.6199 7.51226 14.9211 7.30177 15.2902 7.15604C15.6626 7.00708 16.0901 6.9326 16.5791 6.9326C16.9191 6.9326 17.2429 6.97146 17.5538 7.05242C17.8679 7.13338 18.1432 7.25643 18.386 7.42158C18.6289 7.58997 18.8232 7.8037 18.9625 8.066C19.1017 8.32507 19.1729 8.63594 19.1729 9.00187V13.121H19.1794V13.1242ZM22.1878 13.1242H20.4942V4.98315H22.1878V13.1275V13.1242ZM28.9461 11.7447C28.7032 12.2175 28.3535 12.5867 27.9034 12.849C27.4565 13.1113 26.9222 13.244 26.3037 13.244C25.6851 13.244 25.1508 13.1113 24.7007 12.849C24.2538 12.5834 23.9073 12.2143 23.6612 11.7447C23.4183 11.2687 23.2953 10.7214 23.2953 10.0932C23.2953 9.46494 23.4183 8.9112 23.6612 8.43841C23.9041 7.96238 24.2506 7.59645 24.7007 7.33415C25.1508 7.06861 25.6851 6.93584 26.3037 6.93584C26.9222 6.93584 27.4533 7.06861 27.9034 7.33415C28.3535 7.59645 28.7 7.96562 28.9461 8.43841C29.189 8.9112 29.312 9.46171 29.312 10.0932C29.312 10.7246 29.189 11.2687 28.9461 11.7447ZM33.538 13.7848C33.4247 14.1151 33.2692 14.4001 33.0717 14.643C32.8774 14.8891 32.6313 15.0801 32.3366 15.2129C32.0387 15.3489 31.6825 15.4169 31.2615 15.4169C31.0478 15.4169 30.8437 15.4007 30.6559 15.3651C30.4713 15.3327 30.3159 15.2906 30.1961 15.2421L30.5782 13.9759C30.7757 14.0374 30.9571 14.0698 31.1158 14.0763C31.2777 14.0827 31.4169 14.0439 31.5335 13.9662C31.6533 13.8852 31.7505 13.7524 31.8249 13.5614L31.9253 13.3023L29.733 7.0168H31.5141L32.7802 11.5018H32.845L34.1209 7.0168H35.9149L33.5412 13.7848H33.538Z"
              fill="#536FF2"
            />
            <path
              d="M27.0163 8.47725C26.8285 8.31533 26.5921 8.23438 26.3136 8.23438C26.0351 8.23438 25.7922 8.31533 25.5979 8.47725C25.4068 8.63916 25.2611 8.85937 25.164 9.13786C25.0668 9.41635 25.0215 9.7337 25.0215 10.0899C25.0215 10.4461 25.0701 10.7635 25.164 11.042C25.2611 11.3205 25.4068 11.5407 25.5979 11.7026C25.7922 11.8613 26.0286 11.9422 26.3136 11.9422C26.5985 11.9422 26.8285 11.8613 27.0163 11.7026C27.2041 11.5407 27.3466 11.3205 27.4405 11.042C27.5376 10.7635 27.5862 10.4461 27.5862 10.0899C27.5862 9.7337 27.5376 9.41635 27.4405 9.13786C27.3433 8.85937 27.2041 8.63916 27.0163 8.47725Z"
              fill="#536FF2"
            />
          </svg>
        </a>
      </footer>
    </div>
  )
}

export default AppLayout
